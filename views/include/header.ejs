<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/public/css/main.min.css">
    <link rel="stylesheet" href="/public/css/color.css">
    <link rel="stylesheet" href="/public/css/style.css">
    <link rel="stylesheet" href="/public/css/responsive.css">
</head>

<body>
    <div class="them-layout">
        <div class="topbar stick">
            <div class="logo">
                <a href="/">
                    <img src="/public/img/logo.png" alt="">
                </a>
            </div>
            <div class="top-area">
                <ul class="main-menu" id="main-menu">

                </ul>
                <ul class="setting-area">

                </ul>
            </div>

        </div>
        <script>
            var mainUrl = 'http://localhost:3000'
            function showAddPost() {
                if (localStorage.getItem('accessToken')) {

                    var html = '';
                    html += '<div class="central-meta">';
                    html += '<div class="new-postbox">';
                    html += '<figure>';
                    html += '<img src="' + mainUrl + '/' + window.user.profileImage + '">';
                    html += '</figure>';
                    html += '<div class="newpst-input">';
                    html += '<form method="post" id="form-add-post" onsubmit="return doPost(this)">';
                    html += '<input type="hidden" value="post" name="type">';
                    html += '<textarea name="caption" placeholder="write something" rows="2"></textarea>';
                    html += '<div class="attachments">';
                    html += '<ul>';
                    html += '<li>'
                    html += '<img id="post-img-preview" style="display:none;">';
                    html += '</li>';
                    html += '<li>'

                    html += '<video id="post-video-preview" controls style=" display:none" > </video>';
                    html += '</li>';
                    html += '<li>';
                    html += '<i class="fa fa-image"></i>';
                    html += '<lable class="fileContainer">';
                    html += '<input type="file" accept="image/*" name="image" onchange="previewImagePost(this)">';
                    html += '</lable">';
                    html += '</li>';
                    html += '<li>';
                    html += '<i class="fa fa-video-camera"></i>';
                    html += '<lable class="fileContainer">';
                    html += '<input type="file" accept="video/*" name="video" onchange="previewVideoPost(this)">';
                    html += '</lable">';

                    html += '</li>';
                    html += '<li>';
                    html += '<button type="submit">Post<button>';
                    html += '</li>';
                    html += '</ul>';
                    html += '</form>';
                    html += '</div>';
                    html += '</div>';
                    html += '</div>';


                    document.getElementById('add-post-box').innerHTML = html
                }
            }
            function previewImagePost(self) {
                var file = self.files
                if (file.length > 0) {
                    var fileReader = new FileReader();
                    fileReader.onload = function (event) {
                        document.getElementById('post-img-preview').style.display = '',
                            document.getElementById('post-img-preview').setAttribute('src', event.target.result);
                    }
                    fileReader.readAsDataURL(file[0])
                }

            }
            function previewVideoPost(self) {
                var file = self.files;

                if (file.length > 0) {
                    var fileReader = new FileReader();
                    fileReader.onload = function (event) {
                        document.getElementById('post-video-preview').style.display = '',
                            document.getElementById('post-video-preview').setAttribute('src', event.target.result);
                    }

                    fileReader.readAsDataURL(file[0])
                }
            }

            function doPost(form) {
                const ajax = new XMLHttpRequest();
                ajax.open('POST', '/addPost', true);
                ajax.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        const response = JSON.parse(ajax.responseText)
                        alert(response.message)

                        if (response.status == 'success') {
                            docunment.getElementById('form-add-post').querySelector("input[name='image']").value = "";
                            document.getElementById('form-add-post').querySelector("input[name='video']").value = "";
                            document.getElementById('form-add-post').querySelector("textarea[name='caption']").value = "";


                            document.getElementById('post-video-previe').style.display = "none"
                            document.getElementById('post-img-previe').style.display = "none"

                        }


                    }
                }
                const formData = new FormData(form);
                formData.append('accessToken', localStorage.getItem('accessToken'))
                ajax.send(formData)
                return false
            }

        </script>
        <style>
            #post-img-preview,
            #post-video-preview {
                height: 300px;
                width: 300px;
                object-fit: cover;

            }
        </style>